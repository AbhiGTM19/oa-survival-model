<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knee OA Prognosis System</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü¶µ</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="container">
        <!-- Sidebar / Input Form -->
        <aside class="sidebar">
            <h2>System Inputs</h2>
            <form id="analysisForm">
                <div class="form-group">
                    <label>Patient ID / Name</label>
                    <input type="text" name="patient_id" value="Anonymous">
                </div>

                <div class="form-group">
                    <label>Upload X-Ray</label>
                    <input type="file" name="file" accept="image/*" required>
                </div>

                <h3>Clinical Parameters</h3>
                <div class="row">
                    <div class="col">
                        <label>Age</label>
                        <input type="number" name="age" value="65" min="40" max="90">
                    </div>
                    <div class="col">
                        <label>Sex</label>
                        <select name="sex">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label>BMI</label>
                        <input type="number" name="bmi" value="28.5" step="0.1">
                    </div>
                    <div class="col">
                        <label>KL Grade</label>
                        <select name="kl_grade">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2" selected>2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>WOMAC Total Score</label>
                    <input type="range" name="womac" min="0" max="96" value="25"
                        oninput="this.nextElementSibling.value = this.value">
                    <output>25</output>
                </div>

                <details>
                    <summary>Advanced Clinical (Optional)</summary>
                    <div class="form-group">
                        <label>PASE Activity Score</label>
                        <input type="number" name="pase" value="130">
                    </div>
                    <div class="form-group">
                        <label>KOOS Quality of Life</label>
                        <input type="number" name="koos" value="75">
                    </div>
                    <div class="form-group">
                        <label>Stiffness Score</label>
                        <input type="number" name="stiffness" value="70">
                    </div>
                    <div class="form-group">
                        <label>NSAID Use?</label>
                        <select name="nsaid">
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </div>
                </details>

                <h3>Biochemical Markers</h3>
                <details open>
                    <summary>Lab Assays</summary>
                    <div class="form-group">
                        <label>Serum COMP (ng/mL)</label>
                        <input type="number" name="bio_comp" value="1065.0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Urine CTX-II (ng/mmol)</label>
                        <input type="number" name="bio_ctx" value="350.0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Serum HA (ng/mL)</label>
                        <input type="number" name="bio_ha" value="45.0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Serum C2C (ng/mL)</label>
                        <input type="number" name="bio_c2c" value="180.0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Serum CPII (ng/mL)</label>
                        <input type="number" name="bio_cpii" value="400.0" step="0.1">
                    </div>
                </details>

                <h3>MRI Parameters</h3>
                <details>
                    <summary>MRI Scores</summary>
                    <div class="form-group">
                        <label>MRI BML Score</label>
                        <input type="number" name="mri_bml" value="0.0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>MRI Cyst Score</label>
                        <input type="number" name="mri_cyst" value="0.0" step="0.1">
                    </div>
                </details>

                <button type="submit" id="analyzeBtn">INITIALIZE ANALYSIS</button>
            </form>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header>
                <h1 class="main-header">Tri-Modal Knee Osteoarthritis Prognosis</h1>
                <p class="sub-header">Deep Survival Analysis with Generative Explainability</p>
            </header>

            <div id="loading" class="hidden">
                <div class="spinner"></div>
                <p>Processing Multi-Modal Data...</p>
            </div>

            <div id="results" class="hidden">
                <div class="tabs">
                    <button class="tab-btn active" onclick="openTab('prognosis')">üìä Prognostic Overview</button>
                    <button class="tab-btn" onclick="openTab('visual')">üëÅÔ∏è Visual Analysis</button>
                </div>

                <!-- Tab 1: Prognosis -->
                <div id="prognosis" class="tab-content active">
                    <div class="dashboard-grid">
                        <div class="card risk-card">
                            <h3>Risk Assessment</h3>
                            <div id="riskDisplay">
                                <!-- Injected via JS -->
                            </div>
                        </div>
                        <div class="card drivers-card">
                            <h3>Key Risk Drivers</h3>
                            <ul>
                                <li><strong>Radiographic:</strong> JSN detected</li>
                                <li><strong>Biomarkers:</strong> High COMP Levels</li>
                                <li><strong>Clinical:</strong> Symptomatic Pain (WOMAC)</li>
                            </ul>
                        </div>
                        <div class="card graph-card">
                            <canvas id="survivalChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Visual Analysis -->
                <div id="visual" class="tab-content">
                    <h3>Generative Biomarker Analysis</h3>
                    <p>Diffusion Autoencoder generated counterfactual 'healthy' state.</p>

                    <div class="image-grid">
                        <div>
                            <img id="imgOriginal" src="" alt="Original">
                            <p>Current Anatomy</p>
                        </div>
                        <div>
                            <img id="imgCounterfactual" src="" alt="Counterfactual">
                            <p>Projected Healthy State</p>
                        </div>
                        <div>
                            <img id="imgHeatmap" src="" alt="Heatmap">
                            <p>Difference Map (Anomaly Detection)</p>
                        </div>
                    </div>

                    <div id="findings" class="findings-box">
                        <!-- Injected via JS -->
                    </div>

                    <button id="downloadReportBtn" class="download-btn">üìÑ Download Clinical Report</button>
                </div>
            </div>
        </main>
    </div>

    <script src="/static/script.js"></script>
</body>

</html>